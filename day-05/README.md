# 第05天：结构体、文字显示与GDT/IDT初始化
## out/in指令
向设备发送电信号是out指令，接收电信号指令是in指令。使用设备通过设备端口号来确定设备位置，从而传输数据。

## 向VGA显示器输送信号的步骤
+ 首先在一连串的访问中屏蔽中断（例如CLI）；
+ 将想要设定的调色板号码写入0x03c8，然后按照R,G,B的顺序写入0x03c9。如果这个时候想继续设定下一个调色板，则直接按照RGB的顺序写入0x0c39端口即可。
+ 如果想独处调色板信息，那么需要将调色板号码写入0x03c7端口，然后再从端口0x03c9端口读出即可，读出的顺序即为R,G,B。如果需要继续读出下一个调色板，也是省略调色板号码设置，按照RGB的顺序读出即可。
+ 如果在开始时刻设置了关中断(CLI)，那么在程序结束的时候需要设置开中断。(STI)

## FLAGS寄存器、EFLAGS寄存器和RFLAGS寄存器
FLAGS寄存器是x86微处理器中的状态寄存器，包含有处理器当前状态，这个寄存器是16位宽的，后继者EFLAGS和RFLAGS寄存器的宽度分别是32位和64位。

FLAGS寄存器是存储进位标志和中断标志等标志的寄存器。它用于一些中断标志位、条件等标志位判断其是否是0还是1。

## VGA显示器绘制方式

对于本实验中显示器为320x200x8bit，画面上则会有320x200=64000个像素点，假设左上角是(0,0)坐标，那么右下角则是(319,199)。一般地，对于像素点(x,y)对应的VRAM地址则按照以下的方式进行计算：
```bash
0xa0000 + x + y * 320
```

根据以上像素坐标信息，则可以对图形图像进行绘画处理。

对于图像中的字体信息也是通过描绘像素点绘画出其中的字体信息。

## GDT 与 IDT 的初始化
段表示需要有以下的信息：
+ 段的大小是多少；
+ 段的起始地址位置；
+ 段的管理属性（例如，禁止写入、禁止执行、系统专用）

CPU用8个字节的数据来表示这些信息，但是用于指定的段寄存器只有16位。

段寄存器中低3位不能使用，因此能够使用的段号仅有13位，所以能够处理的就只有0~2^13-1=8191个区域。这样就需要使GDT（全局段号记录表）来存储段号。当CPU遇到外部状况变化，或者是内部偶然发生某些错误时候，会临时切换过去处理这种突发事件，即中断功能。

## 中断功能

中断主要的作用：CPU接收到外部中断信息之后，CPU暂时停止正在处理的任务，并做好接下来能够继续处理的准备，转而执行中断程序。中断程序执行完成之后，再调用事先设定好的函数，返回处理中的任务。得益于中断处理处理基址，CPU可以不用一直查询外部设备，将集中精力处理任务。

通过以上的叙述，所以设置中断记录表，可以对应中断号码与设定的调用函数相关系，调用中断程序处理外部设备信息。

