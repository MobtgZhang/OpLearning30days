# 第03天：进入32位模式并导入C语言
## 主要术语
### 磁盘
+ 盘片：一个磁盘由多个盘片叠加而成，盘片的表面涂有磁性物质，这些磁性物质用来记录二进制数据，由于正反两面都可以涂上磁性物质，所以一个盘片可能会有两个盘面
+ 柱面：每一个盘面对应一个磁头，所有的磁头都是连在同一个磁臂上，所有的磁头智能共进退，所有盘面中相对位置相同的磁道组成柱面。
+ 磁道，每一个盘片呗划分为一个个磁道，每个磁道又划分为一个个扇区，其中内侧磁道上的扇区面积最小，故而数据密度最大。

对于3.5英寸的软盘来说，软盘有80个柱面，2个磁头，18个扇区，并且每个扇区有512字节，故而一张软盘的容量为
512*18*80*2=1474560B=1440KB
### 8086CPU磁盘int13中断
int13中断是直接磁盘服务，具有以下的一些功能：
<center>
    <table>
        <tr>
            <td>中断值</td>
            <td>具体功能</td>
            <td>中断值</td>
            <td>具体功能</td>
        </tr>
        <tr>
            <td>00H</td>
            <td>磁盘系统复位</td>
            <td>0EH</td>
            <td>读扇区缓冲区</td>
        </tr>
        <tr>
            <td>01H</td>
            <td>读取磁盘系统状态</td>
            <td>0FH</td>
            <td>写扇区缓冲区</td>
        </tr>
        <tr>
            <td>02H</td>
            <td>读扇区</td>
            <td>10H</td>
            <td>读取驱动器状态</td>
        </tr>
        <tr>
            <td>03H</td>
            <td>写扇区</td>
            <td>11H</td>
            <td>校准驱动器</td>
        </tr>
        <tr>
            <td>04H</td>
            <td>检验扇区</td>
            <td>12H</td>
            <td>控制器RAM诊断</td>
        </tr>
        <tr>
            <td>05H</td>
            <td>格式化磁道</td>
            <td>13H</td>
            <td>控制器驱动诊断</td>
        </tr>
        <tr>
            <td>06H</td>
            <td>格式化坏磁道</td>
            <td>14H</td>
            <td>控制器内部诊断</td>
        </tr>
        <tr>
            <td>07H</td>
            <td>格式化驱动器</td>
            <td>15H</td>
            <td>读取磁盘类型</td>
        </tr>
        <tr>
            <td>08H</td>
            <td>读取驱动器参数</td>
            <td>16H</td>
            <td>读取磁盘变化状态</td>
        </tr>
        <tr>
            <td>09H</td>
            <td>初始化硬盘参数</td>
            <td>17H</td>
            <td>设置磁盘类型</td>
        </tr>
        <tr>
            <td>0AH</td>
            <td>读长扇区</td>
            <td>18H</td>
            <td>设置格式化媒体类型</td>
        </tr>
        <tr>
            <td>0BH</td>
            <td>写长扇区</td>
            <td>19H</td>
            <td>磁头保护</td>
        </tr>
        <tr>
            <td>0CH</td>
            <td>寻道</td>
            <td>1AH</td>
            <td>格式化ESDI驱动器</td>
        </tr>
        <tr>
            <td>0DH</td>
            <td>硬盘系统复位</td>
            <td></td>
            <td></td>
        </tr>
    </table>
</center>

经常使用的一般有0x02,0x03两个功能，一般有
+ AL=处理对象的扇区数（只能同时处理连续的扇区）；
+ CH=柱面号
+ CL=扇区
+ DH=磁头
+ DL=驱动器，0x00-0x7f是软盘，0x80-0xff是硬盘
+ ES:BX=缓冲区的地址
+ 出口参数：CF=0x00（操作成功），AH=0x00，AL=传输的扇区数，
否则就会有CF=0x01，AH=状态代码，详细参考x86指令集。
### 运行
```bash
# 编译运行磁盘读取文件
make run
# 清除对应的img文件
make clean
```

### 8086CPU的int10中断处理
<center>
    <table>
        <tr>
            <td>中断值</td>
            <td>具体功能</td>
            <td>中断值</td>
            <td>具体功能</td>
        </tr>
        <tr>
            <td>00H</td>
            <td>设置显示器模式</td>
            <td>0EH</td>
            <td>在Teletype模式下显示字符</td>
        </tr>
        <tr>
            <td>01H</td>
            <td>设置光标形状</td>
            <td>0FH</td>
            <td>读取显示器模式</td>
        </tr>
        <tr>
            <td>02H</td>
            <td>设置光标位置</td>
            <td>10H</td>
            <td>颜色</td>
        </tr>
        <tr>
            <td>03H</td>
            <td>读取光标信息</td>
            <td>11H</td>
            <td>字体</td>
        </tr>
        <tr>
            <td>04H</td>
            <td>读取光笔位置</td>
            <td>12H</td>
            <td>显示器的配置</td>
        </tr>
        <tr>
            <td>05H</td>
            <td>设置显示页</td>
            <td>13H</td>
            <td>在Teletype模式下显示字符</td>
        </tr>
        <tr>
            <td>06H、07H</td>
            <td>初始化或滚屏</td>
            <td>1AH</td>
            <td>读取/设置显示组合编码</td>
        </tr>
        <tr>
            <td>08H</td>
            <td>读光标处的字符以及其属性</td>
            <td>1BH</td>
            <td>读取功能/状态信息</td>
        </tr>
        <tr>
            <td>09H</td>
            <td>在光标处按照指定属性显示字符</td>
            <td>1CH</td>
            <td>保存/恢复显示器状态</td>
        </tr>
        <tr>
            <td>0AH</td>
            <td>在当前光标处显示字符</td>
            <td>0BH</td>
            <td>设置调色板、背景色或者边框</td>
        </tr>
    </table>
</center>

设置显卡模式
AH=0x00
本小节需要的AL显示模式
+ 0x03：16色字符模式，80x25
+ 0x12：VGA图形模式，640x480x4位彩色模式，独特四面存储模式
+ 0x13：VGA图形模式，320x200x8位彩色模式，调色板模式
+ 0x6a：扩展VGA图形模式，800x600x4位彩色模式，独特四面存储模式（有的显卡不支持）

### 编译运行
```bash
# 编译对应的文件
make 
# 运行程序
make run
# 清除img
make clean
```
## 从16位实模式到32位保护模式
在16位和32位两种模式当中，机器语言均不一样，所以并不能通用。32位模式下可以使用的内存远远大于1MB，另外CPU的自我保护功能在16位操作系统下，但是32位下能用。

32位模式下，BIOS功能是不可以调用的，BIOS是使用16位机器语言写的。


